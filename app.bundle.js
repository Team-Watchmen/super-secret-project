!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";var r=n(1),o=n(2),a=function(){var e=new o.WeatherApp("#content");return e}();$(function(){r.loadFacebookSDK.load(),a.start()})},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){!function(e,t,n){var r,o=e.getElementsByTagName(t)[0];e.getElementById(n)||(r=e.createElement(t),r.id=n,r.src="//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5",o.parentNode.insertBefore(r,o),e.body.appendChild(r))}(document,"script","facebook-jssdk")}return{load:e}}();t.loadFacebookSDK=n},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.WeatherApp=void 0;var o=function(){function e(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(u){o=!0,a=u}finally{try{!r&&s["return"]&&s["return"]()}finally{if(o)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(3),s=n(4),u=n(7),c=n(11),l=n(12),f=(n(13),function(){var e=void 0,t=void 0,n=void 0,f=void 0,d=void 0,g=function(){function g(o){r(this,g),n=new i.MapProvider,e=new s.UsersManager,t=new u.WeatherProvider,f=new l.TemplatesProvider,d=new c.ProfileScreen,this._contentContainer=$(o),this.__app__=this.__initializeSammyApp__()}return a(g,[{key:"start",value:function(){var t=e.isUserLogged();t?$(document.body).addClass("logged-in"):$(document.body).removeClass("logged-in"),this.__app__.run("#/")}},{key:"__initializeSammyApp__",value:function(){var r=this,a=Sammy("#content",function(){function a(){d.start("#content"),d.displayLocationsListForUser("#location-list")}var i=$("#content");$("#weather");this.get("#/",function(){Promise.all([f.get("home-screen"),f.get("current-weather"),t.getForecast("Paris",1),t.getForecast("New York",1),t.getForecast("Tokyo",1)]).then(function(e){var t=o(e,5),n=t[0],a=t[1],i=t[2],s=t[3],u=t[4],c={a:a(i),b:a(s),c:a(u)},l=n(c);r._contentContainer.html(l)})}),this.get("#/login",function(t){return e.isUserLogged()?(t.redirect("#/"),void toastr.success("","You logged in already!",{positionClass:"toast-bottom-left"})):void f.get("login").then(function(n){i.html(n()),$("#btn-login").on("click",function(){var n={username:$("#username").val(),password:$("#password").val()};e.login(n).then(function(e){$(document.body).addClass("logged-in"),t.redirect("#/profile")})["catch"](function(e){toastr.info(e,{positionClass:"toast-bottom-left"})})})})}),this.get("#/register",function(t){return e.isUserLogged()?void t.redirect("#/"):void f.get("register").then(function(n){i.html(n()),$("#btn-register").on("click",function(){var n={username:$("#new-username").val(),password:$("#new-username").val()};e.register(n).then(function(e){t.redirect("#/login")})["catch"](function(e){toastr.info(e,{positionClass:"toast-bottom-left"})}),toastr.success("Congrats on your registration!")})})}),this.get("#/profile",function(){a()}),this.get("#/profile/:location/:duration",function(e){function i(){var e=String(window.location),t=e.split("/"),n=t.length,r=t[n-2];return r}var s=$("#profile-screen");0===s.length&&a();var u=void 0,c=Number(e.params.duration);switch(isNaN(c)&&(c=14),c){case 1:u="current-weather";break;case 5:u="five-day";break;case 14:u="fourteen-day";break;default:return}Promise.all([t.getForecast(e.params.location,c),f.get(u)]).then(function(e){var t=o(e,2),n=t[0],r=t[1],a=r(n);return $("#weather-tiles").html(a),n}).then(function(e){try{var t=document.getElementById("map-container");t.style.height=window.innerHeight-75+"px",t.style.width="100%",n.initializeMap(e.city.coord.lat,e.city.coord.lon,t)}catch(r){}}).then(function(){var e=String(window.location),t=i(),n=$(r._contentContainer);n.find("#one-day-forecast").attr("href","#/profile/"+t+"/1"),n.find("#five-day-forecast").attr("href","#/profile/"+t+"/5"),n.find("#fourteen-day-forecast").attr("href","#/profile/"+t+"/14"),n.find("#current-weather").addClass("panel-default").removeClass("panel-primary"),n.find("#twttr-share").attr("href","https://twitter.com/intent/tweet?text="+("Team Watchmen Weather forecast for "+t+" ")+e)})["catch"](console.log)}),this.get("#/profile/add",function(t){var n=$("#input-location").val();n&&e.setUserLocations(n).then(function(){a(),window.location="#/profile/"+n+"/1"})["catch"](function(e){toastr.info(e,{positionClass:"toast-bottom-left"})})})});return $("#nav-btn-logout").on("click",function(){e.isUserLogged()?(e.logout().then(function(){$(document.body).remove("logged-in"),window.location="#/"}),toastr.info("","You just logged out!",{positionClass:"toast-bottom-left"})):toastr.info("So, no need to log out :)","You are not logged in!",{positionClass:"toast-bottom-left"})}),a}}]),g}();return g}());t.WeatherApp=f},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){var e=function(){function e(){n(this,e)}return r(e,[{key:"initializeMap",value:function(e,t,n){n instanceof HTMLElement||(n=document.getElementById(n));var r=new google.maps.LatLng(e,t),o={center:r,zoom:7,mapTypeId:google.maps.MapTypeId.HYBRID},a=new google.maps.Map(n,o);new google.maps.Marker({position:r,map:a})}}]),e}();return e}();t.MapProvider=o},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.UsersManager=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(5),s=n(6),u=function(){function e(e){s.Validator.isNullOrUndefined(e),s.Validator.isEmptyString(e),s.Validator.containsOnlyLettersAndDigits(e)}function t(e){s.Validator.isNullOrUndefined(e),s.Validator.isEmptyString(e),s.Validator.containsOnlyLetters(e)}var n="auth-token",u="user-name",c="user-id",l="favourite-locations",f="kid_rJYhi_p3",d="5284c0a9f27b4f7cb2c18cf9e11d7b80",g=f+":"+d,p=new i.Encryptor,v=function(){function i(){o(this,i)}return a(i,[{key:"register",value:function(t){var n=new Promise(function(n,r){try{e(t.username),e(t.password)}catch(o){return void r(o.message)}var a={username:t.username,password:CryptoJS.SHA1(t.password).toString()},i=p.encryptToBase64(g);$.ajax({url:"https://baas.kinvey.com/user/"+f+"/",method:"POST",headers:{Authorization:"Basic "+i},data:JSON.stringify(a),contentType:"application/json",success:function(e){n(e)}})});return n}},{key:"login",value:function(t){var r=new Promise(function(r,o){try{e(t.username),e(t.password)}catch(a){return void o(a.message)}var i={username:t.username,password:CryptoJS.SHA1(t.password).toString()},s=p.encryptToBase64(g);$.ajax({url:"https://baas.kinvey.com/user/"+f+"/login",method:"POST",headers:{Authorization:"Basic "+s},data:JSON.stringify(i),contentType:"application/json",success:function(e){localStorage.setItem(n,e._kmd.authtoken),localStorage.setItem(u,e.username),localStorage.setItem(c,e._id),r(e)}})});return r}},{key:"logout",value:function(){var e=new Promise(function(e,t){localStorage.removeItem(n),localStorage.removeItem(u),localStorage.removeItem(c),localStorage.removeItem(l),$(document.body).removeClass("logged-in"),e()});return e}},{key:"getUserLocations",value:function(){var e=localStorage.getItem(n),t=new Promise(function(t,n){$.ajax({url:"https://baas.kinvey.com/user/"+f+"/"+localStorage.getItem(c),method:"GET",headers:{Authorization:"Kinvey "+e},data:JSON.stringify(),contentType:"application/json",success:function(e){var n=e[l];n=n?n.split(","):[],localStorage.setItem(l,n),t(n)}})});return t}},{key:"setUserLocations",value:function(e){var o=this,a=localStorage.getItem(n),i=new Promise(function(n,i){try{t(e)}catch(s){return void i(s.message)}var u=localStorage.getItem(l);if(u||(u=""),u.indexOf(e)===-1){u=o.addLocation(e,u);var d=r({},l,u);$.ajax({url:"https://baas.kinvey.com/user/"+f+"/"+localStorage.getItem(c),method:"PUT",headers:{Authorization:"Kinvey "+a},data:JSON.stringify(d),contentType:"application/json",success:function(e){localStorage.setItem(l,u),n(e),toastr.success("Cool! You just added a new location ;-)")}})}else n(toastr.info("You already have this location!"))});return i}},{key:"isUserLogged",value:function(){var e=localStorage.getItem(u),t=localStorage.getItem(n);return e?{username:e,token:t}:null}},{key:"addLocation",value:function(e,t){var n=[];return t?(n=t.split(","),n.push(e),n=n.join(",")):n=e,n}}]),i}();return v}();t.UsersManager=u},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){var e=function(){function e(){n(this,e)}return r(e,[{key:"encryptToBase64",value:function(e){var t=CryptoJS.enc.Utf8.parse(e),n=CryptoJS.enc.Base64.stringify(t);return n}}]),e}();return e}();t.Encryptor=o},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){if(null===e||void 0===e)throw new Error("parameter is null or undefined!")}function t(e,t){if(!(e instanceof t))throw new Error(e+" must be instance of "+t)}function n(e){if(0===e.length)throw new Error("parameter is empty string!")}function r(e,t,n){if(e.length<t||e.length>n)throw new Error("parameter must have length between "+t+" and "+n)}function o(e){if("string"!=typeof e)throw new Error("parameter type is not a string!")}function a(e){if(!/^[\d]+$/g.test(e))throw new Error("parameter must contain only digits!")}function i(e){if(!/^[a-zA-Z]+$/g.test(e))throw new Error("parameter must contain only letters!")}function s(e){if(!/^[a-zA-Z0-9]+$/g.test(e))throw new Error("parameter must contain only letters and digits!")}return{isNullOrUndefined:e,isInstanceOf:t,isEmptyString:n,validateStringRange:r,isStringType:o,containsOnlyDigits:a,containsOnlyLetters:i,containsOnlyLettersAndDigits:s}}();t.Validator=n},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.WeatherProvider=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(8),i=n(9),s=n(10),u=function(){var e=function(){function e(){r(this,e)}return o(e,[{key:"getForecast",value:function(e,t){switch(t){case 1:return this._oneDay(e);case 5:return this._fiveDay(e);case 14:return this._fourteenDay(e);default:return new Promise(function(e,t){t("Invalid input")})}}},{key:"_oneDay",value:function(e){var t=this,n=this._getSessionStorageWeatherDataForLocation(e);return n.oneDay?new Promise(function(e,t){var r=JSON.parse(n.oneDay.data);e(r)}):(0,a.getWeatherOneDay)(e).then(function(r){var o=t._prepDataForStorage(r);return n.oneDay=o,sessionStorage[e]=JSON.stringify(n),r})}},{key:"_fiveDay",value:function(e){var t=this,n=this._getSessionStorageWeatherDataForLocation(e);return n.fiveDay?new Promise(function(e,t){var r=JSON.parse(n.fiveDay.data);e(r)}):(0,i.getWeatherFiveDay)(e).then(function(r){var o=t._prepDataForStorage(r);return n.fiveDay=o,sessionStorage[e]=JSON.stringify(n),r})}},{key:"_fourteenDay",value:function(e){var t=this,n=this._getSessionStorageWeatherDataForLocation(e);return n.fourteenDay?new Promise(function(e,t){var r=JSON.parse(n.fourteenDay.data);e(r)}):(0,s.getWeatherFourteenDay)(e).then(function(r){var o=t._prepDataForStorage(r);return n.fourteenDay=o,sessionStorage[e]=JSON.stringify(n),r})}},{key:"_getSessionStorageWeatherDataForLocation",value:function(e){sessionStorage[e]||(sessionStorage[e]=JSON.stringify({}));var t=JSON.parse(sessionStorage[e]);return t}},{key:"_prepDataForStorage",value:function(e){var t={data:JSON.stringify(e),date:new Date};return t}}]),e}();return e}();t.WeatherProvider=u},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(e){return $.getJSON("http://api.openweathermap.org/data/2.5/weather?q="+e+"&units=metric&APPID=a28f075ad9633624934634a4d49a37c5")}var n=function(e){return new Promise(function(t,n){e?t(e):n("failed")})};return n(t(e))};t.getWeatherOneDay=n},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(e){return $.getJSON("http://api.openweathermap.org/data/2.5/forecast/daily?q="+e+"&cnt=5&mode=json&units=metric&appid=a28f075ad9633624934634a4d49a37c5")}var n=function(e){return new Promise(function(t,n){e?t(e):n("failed")})};return n(t(e))};t.getWeatherFiveDay=n},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){function t(e){return $.getJSON("http://api.openweathermap.org/data/2.5/forecast/daily?q="+e+"&cnt=14&mode=json&units=metric&appid=a28f075ad9633624934634a4d49a37c5")}var n=function(e){return new Promise(function(t,n){e?t(e):n("failed")})};return n(t(e))};t.getWeatherFourteenDay=n},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.ProfileScreen=void 0;var o=function(){function e(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(u){o=!0,a=u}finally{try{!r&&s["return"]&&s["return"]()}finally{if(o)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(12),s=n(4),u=function(){var e=function(){function e(){r(this,e),this.users=new s.UsersManager,this.templates=new i.TemplatesProvider}return a(e,[{key:"start",value:function(e){this.templates.get("profile-screen").then(function(t){var n=t(null);$(e).html(n)}).then(function(){return FB.XFBML.parse()})}},{key:"displayLocationsListForUser",value:function(e){Promise.all([this.templates.get("location-list-item"),this.users.getUserLocations()]).then(function(e){var t=o(e,2),n=t[0],r=t[1];r=r.filter(function(e){return e.length>0});var a=n(r);return a}).then(function(t){$(e).html(t)})}}]),e}();return e}();t.ProfileScreen=u},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){var e=function(){function e(){n(this,e)}return r(e,[{key:"get",value:function(e){return window.sessionStorage[e]?new Promise(function(t,n){var r=window.sessionStorage[e];t(r)}).then(function(e){var t=Handlebars.compile(e);return t}):new Promise(function(t,n){$.ajax({url:"templates/"+e+".handlebars",method:"GET"}).done(t).fail(n)}).then(function(t){return window.sessionStorage[e]=t,t}).then(function(e){var t=Handlebars.compile(e);return t})}}]),e}();return e}();t.TemplatesProvider=o},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){return new Promise(function(e,t){var n={enableHighAccuracy:!0,timeout:5e3,maximumAge:0};navigator.geolocation.getCurrentPosition(e,t,n)}).then(function(e){var t={lat:e.coords.latitude,lon:e.coords.longitude};return t})}return{getCurrentGeolocation:e}}();t.geolocation=n}]);